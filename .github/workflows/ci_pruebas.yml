name: Test Unitarios y Cobertura

on:
  push:
    branches:
      - 'feature/**'
      - main
      - develop

jobs:
  tests:
    name: Ejecutar Pruebas y Revisar Cobertura
    runs-on: ubuntu-latest

    steps:
      - name: Chequear CÃ³digo
        uses: actions/checkout@v4

      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'

      - name: Instalar Dependencias
        run: pip install coverage

      - name: Ejecutar Pruebas con Coverage
        run: |
          coverage run -m unittest discover -s tests
          coverage report --fail-under=80 || echo "LOW_COVERAGE=true" >> $GITHUB_ENV
          coverage report > coverage.txt
          coverage html

      - name: Comentar si Coverage es Bajo en el Commit
        if: env.LOW_COVERAGE == 'true'  # Solo ejecuta si la cobertura es baja
        uses: peter-evans/create-or-update-comment@v3
        with:
          commit-sha: ${{ github.sha }}  # Esto pone el comentario en el commit directamente
          body: |
            ðŸš¨ **Coverage bajo el mÃ­nimo requerido (80%)**
            
            El reporte de cobertura es:
            ```
            $(cat coverage.txt)
            ```
